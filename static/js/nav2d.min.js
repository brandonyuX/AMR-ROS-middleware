!function(t,n){"object"==typeof exports&&"object"==typeof module?module.exports=n(require("uuid"),require("point-in-polygon"),require("earcut"),require("simple-quadtree")):"function"==typeof define&&define.amd?define(["uuid","point-in-polygon","earcut","simple-quadtree"],n):"object"==typeof exports?exports.nav2d=n(require("uuid"),require("point-in-polygon"),require("earcut"),require("simple-quadtree")):t.nav2d=n(t.uuid,t["point-in-polygon"],t.earcut,t["simple-quadtree"])}("undefined"!=typeof self?self:this,(function(t,n,e,r){return function(t){var n={};function e(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,e),i.l=!0,i.exports}return e.m=t,e.c=n,e.d=function(t,n,r){e.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:r})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,n){if(1&n&&(t=e(t)),8&n)return t;if(4&n&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(e.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var i in t)e.d(r,i,function(n){return t[n]}.bind(null,i));return r},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},e.p="",e(e.s=4)}([function(n,e){n.exports=t},function(t,e){t.exports=n},function(t,n){t.exports=e},function(t,n){t.exports=r},function(t,n,e){"use strict";function r(t,n){for(var e=0;e<n.length;e++){var r=n[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}e.r(n),e.d(n,"Point",(function(){return D})),e.d(n,"Vector",(function(){return i})),e.d(n,"isclose",(function(){return a})),e.d(n,"clip",(function(){return l})),e.d(n,"dot",(function(){return u})),e.d(n,"cross",(function(){return o})),e.d(n,"Edge",(function(){return F})),e.d(n,"Polygon",(function(){return A})),e.d(n,"NavMesh",(function(){return M}));var i=function(){function t(n,e){if(function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,t),"number"!=typeof n||"number"!=typeof e)throw new Error("Vector components must be numbers.");this.x=n,this.y=e}var n,e,i;return n=t,(e=[{key:"_normOther",value:function(n){return"number"==typeof n?new t(n,n):n}},{key:"add",value:function(n){return n=this._normOther(n),new t(this.x+n.x,this.y+n.y)}},{key:"sub",value:function(n){return n=this._normOther(n),new t(this.x-n.x,this.y-n.y)}},{key:"mul",value:function(n){return n=this._normOther(n),new t(this.x*n.x,this.y*n.y)}},{key:"div",value:function(n){return n=this._normOther(n),new t(this.x/n.x,this.y/n.y)}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"equals",value:function(t){return a(this.x,t.x)&&a(this.y,t.y)}},{key:"angle",value:function(t){return Math.acos(l(-1,1,u(this,t)/(this.length()*t.length())))}},{key:"counterclockwiseAngle",value:function(t){var n=this.angle(t);return o(this,t)>=0?n:2*Math.PI-n}},{key:"toString",value:function(){return"{ x: ".concat(this.x,", y: ").concat(this.y," }")}}])&&r(n.prototype,e),i&&r(n,i),t}();function u(t,n){return t.x*n.x+t.y*n.y}function o(t,n){return t.x*n.y-t.y*n.x}function a(t,n){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e-8;return t>n-e&&t<n+e}function l(t,n,e){return e<t?t:e>n?n:e}var s=e(0),c=e(1),f=e.n(c),h=e(2),p=e.n(h),y=e(3),d=e.n(y);class v{constructor(t=[],n=g){if(this.data=t,this.length=this.data.length,this.compare=n,this.length>0)for(let t=(this.length>>1)-1;t>=0;t--)this._down(t)}push(t){this.data.push(t),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const t=this.data[0],n=this.data.pop();return this.length--,this.length>0&&(this.data[0]=n,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:n,compare:e}=this,r=n[t];for(;t>0;){const i=t-1>>1,u=n[i];if(e(r,u)>=0)break;n[t]=u,t=i}n[t]=r}_down(t){const{data:n,compare:e}=this,r=this.length>>1,i=n[t];for(;t<r;){let r=1+(t<<1),u=n[r];const o=r+1;if(o<this.length&&e(n[o],u)<0&&(r=o,u=n[o]),e(u,i)>=0)break;n[t]=u,t=r}n[t]=i}}function g(t,n){return t<n?-1:t>n?1:0}function b(t,n){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable}))),e.push.apply(e,r)}return e}function _(t){for(var n=1;n<arguments.length;n++){var e=null!=arguments[n]?arguments[n]:{};n%2?b(Object(e),!0).forEach((function(n){m(t,n,e[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):b(Object(e)).forEach((function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))}))}return t}function m(t,n,e){return n in t?Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[n]=e,t}function x(t,n){return function(t){if(Array.isArray(t))return t}(t)||function(t,n){if(!(Symbol.iterator in Object(t))&&"[object Arguments]"!==Object.prototype.toString.call(t))return;var e=[],r=!0,i=!1,u=void 0;try{for(var o,a=t[Symbol.iterator]();!(r=(o=a.next()).done)&&(e.push(o.value),!n||e.length!==n);r=!0);}catch(t){i=!0,u=t}finally{try{r||null==a.return||a.return()}finally{if(i)throw u}}return e}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function w(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function O(t,n){for(var e=0;e<n.length;e++){var r=n[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function k(t,n,e){return n&&O(t.prototype,n),e&&O(t,e),t}function P(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function j(t,n,e){return(j=P()?Reflect.construct:function(t,n,e){var r=[null];r.push.apply(r,n);var i=new(Function.bind.apply(t,r));return e&&S(i,e.prototype),i}).apply(null,arguments)}function S(t,n){return(S=Object.setPrototypeOf||function(t,n){return t.__proto__=n,t})(t,n)}function q(t){return function(t){if(Array.isArray(t)){for(var n=0,e=new Array(t.length);n<t.length;n++)e[n]=t[n];return e}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function E(t){return t instanceof Array?j(i,q(t)):t instanceof i?t:t.hasOwnProperty("x")&&t.hasOwnProperty("y")?new i(t.x,t.y):void 0}var F=function(){function t(n,e){w(this,t),this._uuid=Object(s.v4)(),this.p1=E(n),this.p2=E(e)}return k(t,[{key:"length",value:function(){return this.p1.sub(this.p2).length()}},{key:"direction",value:function(){return this.p1.sub(this.p2)}},{key:"onEdge",value:function(t){t=E(t);var n=this.p1.sub(t);if(!this.parallel(n))return!1;var e=this.direction(),r=this.length(),i=u(e,n)/(r*r);return i>=0&&i<=1}},{key:"parallel",value:function(t){var n=t instanceof i?t:t.p1.sub(t.p2);return a(o(this.direction(),n),0)}},{key:"collinear",value:function(t){var n=this.direction(),e=this.p1.sub(t.p1),r=this.p1.sub(t.p2);return a(o(n,e),0)&&a(o(n,r),0)}},{key:"overlap",value:function(n){if(!this.collinear(n))throw new Error("Cannot compute overlap of two non-collinear edges.");var e=[];return this.onEdge(n.p1)&&e.push(n.p1),this.onEdge(n.p2)&&e.push(n.p2),n.onEdge(this.p1)&&e.push(this.p1),n.onEdge(this.p2)&&e.push(this.p2),e.length>2&&(e=e.filter((function(t,n){return e.findIndex((function(n){return n.equals(t)}))===n}))),e.length?(1==e.length&&(e=[e[0],e[0]]),j(t,q(e))):null}},{key:"equals",value:function(t){return this.p1.equals(t.p1)&&this.p2.equals(t.p2)||this.p1.equals(t.p2)&&this.p2.equals(t.p1)}}]),t}(),A=function(){function t(n){w(this,t),this._uuid=Object(s.v4)(),this.points=n.map(E),this.bounds=this._computeBounds()}return k(t,[{key:"_computeBounds",value:function(){return this.points.reduce((function(t,n){return[Math.min(n.x,t[0]),Math.min(n.y,t[1]),Math.max(n.x,t[2]),Math.max(n.y,t[3])]}),[1/0,1/0,-1/0,-1/0])}},{key:"edges",value:function(){var t=this;return this.points.map((function(n,e){return new F(0==e?t.points[t.points.length-1]:t.points[e-1],n)}))}},{key:"centroid",value:function(){return this.points.reduce((function(t,n){return t.add(n)}),new i(0,0)).div(this.points.length)}},{key:"centroidDistance",value:function(t){return this.centroid().sub(t.centroid()).length()}},{key:"contains",value:function(t){t=E(t);var n=this.points.map(this._toPointArray);return f()(this._toPointArray(t),n)||!!this.onEdge(t)}},{key:"_toPointArray",value:function(t){return[t.x,t.y]}},{key:"onEdge",value:function(t){t=E(t);var n=!0,e=!1,r=void 0;try{for(var i,u=this.edges()[Symbol.iterator]();!(n=(i=u.next()).done);n=!0){var o=i.value;if(o.onEdge(t))return o}}catch(t){e=!0,r=t}finally{try{n||null==u.return||u.return()}finally{if(e)throw r}}return null}},{key:"touches",value:function(t){var n=!0,e=!1,r=void 0;try{for(var i,u=this.edges()[Symbol.iterator]();!(n=(i=u.next()).done);n=!0){var o=i.value;if((o.onEdge(t.p1)||o.onEdge(t.p2))&&o.collinear(t))return o}}catch(t){e=!0,r=t}finally{try{n||null==u.return||u.return()}finally{if(e)throw r}}return null}},{key:"boundsSize",value:function(){var t=x(this.bounds,4),n=t[0],e=t[1];return{x:n,y:e,w:t[2]-n,h:t[3]-e}}}]),t}(),M=function(){function t(n){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;w(this,t),this._uuid=Object(s.v4)(),this.polygons=this._triangulate(n).map((function(t){return new A(t)})),this.costFunc=e,this.heuristicFunc=r,this.pointQuerySize=.01,this._buildQuadtree(),this._buildNeighbors()}return k(t,[{key:"_triangulate",value:function(t){var n=this,e=[],r=!0,i=!1,u=void 0;try{for(var o,a=function(){for(var t=o.value,r=p()(n._flatten(t)),i=0;i<r.length/3;i++){var u=r.slice(3*i,3*i+3);e.push(u.map((function(n){return t[n]})))}},l=t[Symbol.iterator]();!(r=(o=l.next()).done);r=!0)a()}catch(t){i=!0,u=t}finally{try{r||null==l.return||l.return()}finally{if(i)throw u}}return e}},{key:"_flatten",value:function(t){var n=[],e=!0,r=!1,i=void 0;try{for(var u,o=t[Symbol.iterator]();!(e=(u=o.next()).done);e=!0){var a=u.value;a instanceof Array?n.push.apply(n,q(a)):n.push(a.x,a.y)}}catch(t){r=!0,i=t}finally{try{e||null==o.return||o.return()}finally{if(r)throw i}}return n}},{key:"_buildQuadtree",value:function(){this.qt=d()(-1/0,-1/0,1/0,1/0);var t=!0,n=!1,e=void 0;try{for(var r,i=this.polygons[Symbol.iterator]();!(t=(r=i.next()).done);t=!0){var u=r.value;this.qt.put(_(_({},u.boundsSize()),{},{polygon:u}))}}catch(t){n=!0,e=t}finally{try{t||null==i.return||i.return()}finally{if(n)throw e}}}},{key:"_buildNeighbors",value:function(){this.polygons.forEach((function(t){return t.neighbors={}}));for(var t=0;t<this.polygons.length;t++){var n=this.polygons[t],e=!0,r=!1,i=void 0;try{for(var u,o=this.qt.get(n.boundsSize())[Symbol.iterator]();!(e=(u=o.next()).done);e=!0){var a=u.value.polygon;if(n!==a&&!n.neighbors.hasOwnProperty(a._uuid)){var l=this._computePortal(n,a);if(null!==l&&l.length()>0){var s=x(this._orderLeftRight(n.centroid(),l.p1,l.p2),2),c=s[0],f=s[1];n.neighbors[a._uuid]={polygon:a,portal:new F(c,f)},a.neighbors[n._uuid]={polygon:n,portal:new F(f,c)}}}}}catch(t){r=!0,i=t}finally{try{e||null==o.return||o.return()}finally{if(r)throw i}}}}},{key:"_computePortal",value:function(t,n){var e=!0,r=!1,i=void 0;try{for(var u,o=t.edges()[Symbol.iterator]();!(e=(u=o.next()).done);e=!0){var a=u.value,l=n.touches(a);if(null!==l)return a.overlap(l)}}catch(t){r=!0,i=t}finally{try{e||null==o.return||o.return()}finally{if(r)throw i}}return null}},{key:"findPath",value:function(t,n){t=E(t),n=E(n);var e=this._findPath(t,n);return e&&this._funnel(t,n,e)}},{key:"_findPath",value:function(t,n){var e=this._findContainingPolygon(t),r=this._findContainingPolygon(n);if(null===e||null===r)return null;for(var i=new v([{cost:0,polygon:e}],(function(t,n){return t.cost-n.cost})),u=m({},e._uuid,null),o=m({},e._uuid,0);i.length;){var a=i.pop().polygon;if(a._uuid===r._uuid)break;for(var l=0,s=Object.values(a.neighbors);l<s.length;l++){var c=s[l].polygon,f=o[a._uuid]+this._computeCost(a,c);(!o.hasOwnProperty(c._uuid)||f<o[c._uuid])&&(i.push({cost:f+this._heuristic(c,r),polygon:c}),o[c._uuid]=f,u[c._uuid]=a)}}return this._reconstructPath(r,u)}},{key:"_computeDistance",value:function(t,n){return t.centroidDistance(n)}},{key:"_computeCost",value:function(t,n){if(null!==this.costFunc){var e=t.neighbors[n._uuid].portal;return this.costFunc(t,n,e)}return this._computeDistance(t,n)}},{key:"_heuristic",value:function(t,n){return t._uuid==n._uuid?0:null!==this.heuristicFunc?this.heuristicFunc(t,n):this._computeDistance(t,n)}},{key:"_findContainingPolygon",value:function(t){var n=this.pointQuerySize/2,e={x:t.x-n,y:t.y-n,w:this.pointQuerySize,h:this.pointQuerySize},r=!0,i=!1,u=void 0;try{for(var o,a=this.qt.get(e)[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var l=o.value;if(l.polygon.contains(t))return l.polygon}}catch(t){i=!0,u=t}finally{try{r||null==a.return||a.return()}finally{if(i)throw u}}return null}},{key:"_reconstructPath",value:function(t,n){if(!n.hasOwnProperty(t._uuid))return null;for(var e=t,r=[];null!==e;)r.push(e),e=n[e._uuid];return r.reverse()}},{key:"_funnel",value:function(t,n,e){if(0===e.length)throw new Error("Path cannot be empty.");if(1===e.length)return[t,n];var r=[t],i=[],u=[],o=e[0].neighbors[e[1]._uuid].portal;i.push(o.p1),u.push(o.p2);for(var a=1;a<e.length-1;a++){var l=e[a],s=e[a+1],c=l.neighbors[s._uuid].portal;this._extendFunnel(r,i,u,c.p1,c.p2)}return this._extendFunnel(r,i,u,n,n),r}},{key:"_extendFunnel",value:function(t,n,e,r,i){this._extendFunnelSide(t,n,e,!0,r),this._extendFunnelSide(t,n,e,!1,i)}},{key:"_extendFunnelSide",value:function(t,n,e,r,i){var u=t[t.length-1];if(!r){var o=[e,n];n=o[0],e=o[1]}var a=0===n.length?t[t.length-1]:n[n.length-1];if(!i.equals(a)){var l=this._findFirstLeftOfPoint(u,n,i,!0,!r);if(n.length=l,n.push(i),0===l){var s=this._findFirstLeftOfPoint(u,e,i,!1,r);t.push.apply(t,q(e.splice(0,s)))}}}},{key:"_findFirstLeftOfPoint",value:function(t,n,e,r,i){var u;for(u=0;u<n.length;u++){if(i?this._isInLeftRightOrder(t,e,n[u],r):this._isInLeftRightOrder(t,n[u],e,r))return u}return u}},{key:"_isInLeftRightOrder",value:function(t,n,e){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=n.sub(t),u=e.sub(t),a=o(i,u);return r?a<=0:a<0}},{key:"_orderLeftRight",value:function(t,n,e){return this._isInLeftRightOrder(t,n,e)?[n,e]:[e,n]}}]),t}(),D=i}])}));
//# sourceMappingURL=nav2d.min.js.map